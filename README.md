# Log4J Viewer

This repository provides a set of eclipse plugins (backend and frontend) to capture log events generated by [apache's log4j 2.x](https://logging.apache.org/log4j/2.x/index.html) logging facilities and written to a [SocketAppender](https://logging.apache.org/log4j/2.x/manual/appenders/network.html#SocketAppender).

The current implementation supports the following layouts:

*   [SerializedLayout](https://logging.apache.org/log4j/2.x/manual/layouts.html#SerializedLayout): default, deprecated and unsafe but still widely used for development purposes
*   [XmlLayout](https://logging.apache.org/log4j/2.x/manual/layouts.html#XMLLayout): deprecated but widely used for its generic readability
*   [JsonLayout](https://logging.apache.org/log4j/2.x/manual/layouts.html#JSONLayout): deprecated but widely used for its simplicity

Although the log4j team encourages developers to switch to the more generic and extensible [JsonLayoutTemplate](https://logging.apache.org/log4j/2.x/manual/layouts.html#JSONTemplateLayout) mechanism, there are still quite some problems to solve in order to be able to actually read its output.

![](docs/images/logviewer.png)

Incoming log events are displayed in a special table view providing an overview over the most important event fields, starting/stopping the event capturing, pausing table updates and clearing its contents.

![](docs/images/logviewer_filter.png)

It can be filtered by columns. Each column filter can then be customized just like find/replace eclipse menu (including regular expressions etc.).

![](docs/images/logviewer_export.png)

The displayed (and potentially filtered) events can also be exported to a file for offline analysis.

![](docs/images/logviewer_context_menu.png)

The table's context menu (or a double-click on selected item) provides means to view event details (including exception stacktraces).

![](docs/images/logviewer_details.png)

If parts of the stacktrace are loaded as resources in your IDE, you will be able to navigate straight to the appropriate lines by simply clicking on the links in the stacktrace.

![](docs/images/logviewer_preferences.png)

The view itself is limited to a fixed number of log events (configurable via preference page) so your IDE does not use up all available memory for log intensive applications. It also takes advantage of virtual tables which improves performance and further reduces memory usage.

# Architecture

The most important part of the implementation is the event server which listens to connection requests from `SocketAppender`s, resolves the appropriate handler for it and spawns a new thread which will receive incoming log events and dispatch them to the event consumer. Here is a rough UML diagram showing the relevant classes and interfaces.

![](docs/images/architecture.drawio.png "Architecture") 

The `org.wtlnw.eclipse.log4j.viewer.core.impl.LogEventServer` is a standalone server implementation and does not rely on any eclipse specific mechanics. Initializing it with `org.wtlnw.eclipse.log4j.viewer.core.api.LogEventSupplierFactory` implementations and a `java.util.function.Consumer<LogEvent>` to be notified is enough to get it started.

# Building

The repository relies on eclipse's [tycho](https://tycho.eclipseprojects.io/doc/latest/StructuredBuild.html) for build and testing using CI friendly maven layout. It's highly recommended to install **M2E - PDE Integration** plugin to make your life easier when integrating additional functionality or upgrading maven dependencies.

Other than that, your usual maven commands (like `mvn verify` etc.) can be used.

# Extending

The main extension point is the `LogEventSupplierRegistry` which allows for additional implementations of `LogEventSupplierFactory` to support other event layouts using the extension point with id `org.wtlnw.eclipse.log4j.viewer.core.events`. Make sure to read the javadoc for `LogEventSupplierFactory` and `LogEventSupplier` for implementation hints and also provided implementation for inspiration purposes.

Be aware however, that only one `LogEventSupplierFactory` can be selected for an incoming connection thus preventing existing implementations from being overwritten. If you'd like to overwrite an existing implementation, you will have to uninstall the plugin providing that particular implementation first and the replace it with your own extension.
